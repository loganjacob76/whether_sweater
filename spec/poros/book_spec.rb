require 'rails_helper'

RSpec.describe Book do
  before :each do
    data = {:numFound=>606,
      :start=>0,
      :numFoundExact=>true,
      :docs=>
       [{:key=>"/works/OL8503198W",
         :text=>["/works/OL8503198W", "Denver, Co", "OL10909613M", "9780762507849", "0762507845", "Universal Map Enterprises", "OL2843451A", "Universal Map"],
         :type=>"work",
         :seed=>["/books/OL10909613M", "/works/OL8503198W", "/authors/OL2843451A"],
         :title=>"Denver, Co",
         :title_suggest=>"Denver, Co",
         :has_fulltext=>false,
         :edition_count=>1,
         :edition_key=>["OL10909613M"],
         :publish_date=>["January 2001"],
         :publish_year=>[2001],
         :first_publish_year=>2001,
         :isbn=>["9780762507849", "0762507845"],
         :last_modified_i=>1338943517,
         :ebook_count_i=>0,
         :publisher=>["Universal Map Enterprises"],
         :language=>["eng"],
         :author_key=>["OL2843451A"],
         :author_name=>["Universal Map"],
         :publisher_facet=>["Universal Map Enterprises"],
         :_version_=>1700720295581581317,
         :author_facet=>["OL2843451A Universal Map"]},
        {:key=>"/works/OL896607W",
         :text=>
          ["/works/OL896607W",
           "Denver west, CO and Bailey, CO: Denver, CO",
           "39105, digital raster graphic data",
           "Denver west, CO and Bailey, CO: Denver, CO ",
           "OL10945157M",
           "9780607620054",
           "0607620056",
           "USGS Branch of Distribution",
           "OL79165A",
           "United States Geological Survey",
           "Geological Survey (U.S.)",
           "Geological Survey. (U.S.)",
           "United States. Geological survey.",
           "United States. Geological Survey",
           "United States. Geological Survey.",
           "Geological Survey (U. S.)",
           "Geological Survey (U.S.) 088",
           "U.S. Geological Survey",
           "Geological Survey (U .S.)"],
         :type=>"work",
         :seed=>["/books/OL10945157M", "/works/OL896607W", "/authors/OL79165A"],
         :title=>"Denver west, CO and Bailey, CO: Denver, CO",
         :title_suggest=>"Denver west, CO and Bailey, CO: Denver, CO",
         :subtitle=>"39105, digital raster graphic data",
         :has_fulltext=>false,
         :edition_count=>1,
         :edition_key=>["OL10945157M"],
         :publish_date=>["1996"],
         :publish_year=>[1996],
         :first_publish_year=>1996,
         :isbn=>["9780607620054", "0607620056"],
         :last_modified_i=>1272517172,
         :ebook_count_i=>0,
         :publisher=>["USGS Branch of Distribution"],
         :language=>["eng"],
         :author_key=>["OL79165A"],
         :author_name=>["United States Geological Survey"],
         :author_alternative_name=>
          ["Geological Survey (U.S.)",
           "Geological Survey. (U.S.)",
           "United States. Geological survey.",
           "United States. Geological Survey",
           "United States. Geological Survey.",
           "Geological Survey (U. S.)",
           "Geological Survey (U.S.) 088",
           "U.S. Geological Survey",
           "Geological Survey (U .S.)"],
         :publisher_facet=>["USGS Branch of Distribution"],
         :_version_=>1700720896589692931,
         :author_facet=>["OL79165A United States Geological Survey"]},
        {:key=>"/works/OL896605W",
         :text=>
          ["/works/OL896605W",
           "Denver East, CO and Castle Rock, CO: Denver, CO",
           "39104, digital raster graphic data",
           "Denver East, CO and Castle Rock, CO: Denver, CO ",
           "OL10945156M",
           "0607620048",
           "9780607620047",
           "USGS Branch of Distribution",
           "OL79165A",
           "United States Geological Survey",
           "Geological Survey (U.S.)",
           "Geological Survey. (U.S.)",
           "United States. Geological survey.",
           "United States. Geological Survey",
           "United States. Geological Survey.",
           "Geological Survey (U. S.)",
           "Geological Survey (U.S.) 088",
           "U.S. Geological Survey",
           "Geological Survey (U .S.)"],
         :type=>"work",
         :seed=>["/books/OL10945156M", "/works/OL896605W", "/authors/OL79165A"],
         :title=>"Denver East, CO and Castle Rock, CO: Denver, CO",
         :title_suggest=>"Denver East, CO and Castle Rock, CO: Denver, CO",
         :subtitle=>"39104, digital raster graphic data",
         :has_fulltext=>false,
         :edition_count=>1,
         :edition_key=>["OL10945156M"],
         :publish_date=>["1996"],
         :publish_year=>[1996],
         :first_publish_year=>1996,
         :isbn=>["0607620048", "9780607620047"],
         :last_modified_i=>1272517172,
         :ebook_count_i=>0,
         :publisher=>["USGS Branch of Distribution"],
         :language=>["eng"],
         :author_key=>["OL79165A"],
         :author_name=>["United States Geological Survey"],
         :author_alternative_name=>
          ["Geological Survey (U.S.)",
           "Geological Survey. (U.S.)",
           "United States. Geological survey.",
           "United States. Geological Survey",
           "United States. Geological Survey.",
           "Geological Survey (U. S.)",
           "Geological Survey (U.S.) 088",
           "U.S. Geological Survey",
           "Geological Survey (U .S.)"],
         :publisher_facet=>["USGS Branch of Distribution"],
         :_version_=>1700720895856738305,
         :author_facet=>["OL79165A United States Geological Survey"]},
        {:key=>"/works/OL8808821W",
         :text=>["/works/OL8808821W", "University of Denver Co 2007", "OL8537031M", "150368610", "1427401683", "9781427401687", "College Prowler", "OL3010394A", "College Prowler"],
         :type=>"work",
         :seed=>["/books/OL8537031M", "/works/OL8808821W", "/authors/OL3010394A"],
         :title=>"University of Denver Co 2007",
         :title_suggest=>"University of Denver Co 2007",
         :has_fulltext=>false,
         :edition_count=>1,
         :edition_key=>["OL8537031M"],
         :publish_date=>["July 1, 2006"],
         :publish_year=>[2006],
         :first_publish_year=>2006,
         :oclc=>["150368610"],
         :isbn=>["1427401683", "9781427401687"],
         :last_modified_i=>1304171421,
         :ebook_count_i=>0,
         :cover_edition_key=>"OL8537031M",
         :cover_i=>1847337,
         :publisher=>["College Prowler"],
         :language=>["eng"],
         :author_key=>["OL3010394A"],
         :author_name=>["College Prowler"],
         :id_goodreads=>["2985742"],
         :publisher_facet=>["College Prowler"],
         :_version_=>1700720648496611328,
         :author_facet=>["OL3010394A College Prowler"]},
        {:key=>"/works/OL4437736W",
         :text=>["/works/OL4437736W", "Denver Co Deluxe Flip Map", "OL10911511M", "9780762557363", "0762557362", "Universal Map Enterprises", "OL882946A", "Laura Ryder"],
         :type=>"work",
         :seed=>["/books/OL10911511M", "/works/OL4437736W", "/authors/OL882946A"],
         :title=>"Denver Co Deluxe Flip Map",
         :title_suggest=>"Denver Co Deluxe Flip Map",
         :has_fulltext=>false,
         :edition_count=>1,
         :edition_key=>["OL10911511M"],
         :publish_date=>["January 2003"],
         :publish_year=>[2003],
         :first_publish_year=>2003,
         :isbn=>["9780762557363", "0762557362"],
         :last_modified_i=>1260838560,
         :ebook_count_i=>0,
         :publisher=>["Universal Map Enterprises"],
         :language=>["eng"],
         :author_key=>["OL882946A"],
         :author_name=>["Laura Ryder"],
         :publisher_facet=>["Universal Map Enterprises"],
         :_version_=>1700714547654950913,
         :author_facet=>["OL882946A Laura Ryder"]}],
      :num_found=>606}
    @books = Book.new(data, 'denver, co')
  end
  
  it 'has attributes', :vcr do
    expect(@books.id).to eq(nil)
    expect(@books.destination).to eq('denver, co')
    expect(@books.total_books_found).to eq(606)
    expect(@books.forecast).to eq({:summary=>"clear sky", :temperature=>"85 F"})
    expect(@books.books.count).to eq(5)
    @books.books.each do |book|
      expect(book).to be_a Hash

      expect(book).to have_key :isbn
      expect(book[:isbn]).to be_a Array

      expect(book).to have_key :title
      expect(book[:title]).to be_a String

      expect(book).to have_key :publisher
      expect(book[:publisher]).to be_a Array
    end
  end
end